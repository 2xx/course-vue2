"use strict";(self["webpackChunkedu_boss_fed"]=self["webpackChunkedu_boss_fed"]||[]).push([[728],{22694:function(t,e,o){o.r(e),o.d(e,{default:function(){return z}});var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"course-content"},[o("div",{staticClass:"content-header"},[o("el-page-header",{attrs:{content:t.course.courseName},on:{back:t.goBack}}),o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSectionDlg()}}},[t._v("十 添加章节")])],1),o("el-card",{staticClass:"box-card"},[o("el-tree",{attrs:{data:t.courseContent,props:t.defaultProps,draggable:"","allow-drop":t.handleDrop},on:{"node-drop":t.onDroped},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,a=e.data;return o("span",{staticClass:"custom-tree-node"},[o("span",[t._v(t._s(s.label))]),a.sectionName?o("span",[o("el-button",{on:{click:function(e){return e.stopPropagation(),t.handleSectionDlg(a)}}},[t._v("编辑")]),o("el-button",{attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.handleLessonDlg(s,a)}}},[t._v(" 添加课时 ")]),o("el-button",{on:{click:function(e){return e.stopPropagation(),t.handleChangeStatusDlg(s,a)}}},[t._v(" "+t._s(t.sectionStatusData[a.status])+" ")])],1):t._e(),a.theme?o("span",[o("el-button",{on:{click:function(e){return e.stopPropagation(),t.handleLessonDlg(s,a)}}},[t._v("编辑")]),o("el-button",{attrs:{type:"success"},on:{click:function(e){return t.handUploadDlg(s,a)}}},[t._v(" 上传视频 ")]),o("el-button",{on:{click:function(e){return e.stopPropagation(),t.handleChangeStatusDlg(s,a)}}},[t._v(" "+t._s(t.lessonStatusData[a.status])+" ")])],1):t._e()])}}])})],1),o("section-dialog-create-or-edit",{ref:"sectionDlg",on:{change:t.loadCourseContent}}),o("lesson-dialog-create-or-edit",{ref:"lessonDlg",on:{change:t.loadCourseContent}}),o("change-status",{ref:"changeStatusDlg"}),o("upload-video-image-dialog",{ref:"uploadDlg"})],1)},a=[],n=(o(9653),o(21249),o(41539),o(78783),o(33948),o(25972)),i=function(t){return(0,n.Z)({method:"GET",url:"/boss/course/section/getSectionAndLesson",params:{courseId:t}})},r=function(t){return(0,n.Z)({method:"POST",url:"/boss/course/section/saveOrUpdateSection",data:t})},l=function(t){return(0,n.Z)({method:"POST",url:"/boss/course/lesson/saveOrUpdate",data:t})},u=o(83938),d=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.title,visible:t.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[o("el-form",{attrs:{model:t.form}},[o("el-form-item",{attrs:{label:"课程名称"}},[o("el-input",{attrs:{disabled:!0},model:{value:t.form.courseName,callback:function(e){t.$set(t.form,"courseName",e)},expression:"form.courseName"}})],1),o("el-form-item",{attrs:{label:"章节名称"}},[o("el-input",{model:{value:t.form.sectionName,callback:function(e){t.$set(t.form,"sectionName",e)},expression:"form.sectionName"}})],1),o("el-form-item",{attrs:{label:"章节描述"}},[o("el-input",{model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),o("el-form-item",{attrs:{label:"章节排序"}},[o("el-input",{model:{value:t.form.orderNum,callback:function(e){t.$set(t.form,"orderNum",e)},expression:"form.orderNum"}})],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)},c=[],m={name:"SectionDialogCreateOrEdit",data:function(){return{dialogFormVisible:!1,isCreate:!1,title:"",initData:{},form:{id:void 0,courseId:0,courseName:"",sectionName:"",description:"",orderNum:0,status:0},formLabelWidth:"120px"}},created:function(){this.initData=Object.assign({},this.form)},methods:{showAndInit:function(t,e){this.dialogFormVisible=!0,this.form=Object.assign({},this.initData),e?(this.isCreate=!1,this.title="更新章节",Object.assign(this.form,e)):(this.isCreate=!0,this.title="添加章节"),this.form.courseId=t.id,this.form.courseName=t.courseName},onSubmit:function(){var t=this;r(this.form).then((function(e){var o=t.isCreate?"添加章节":"更新章节";"000000"===e.data.code?(t.$message.success("".concat(o,"成功!")),t.$emit("change")):t.$message.error("".concat(o,"失败..."))})).finally((function(){t.dialogFormVisible=!1}))}}},f=m,p=o(1001),h=(0,p.Z)(f,d,c,!1,null,"59899a4c",null),g=h.exports,b=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.title,visible:t.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[o("el-form",{attrs:{model:t.form}},[o("el-form-item",{attrs:{label:"课程名称"}},[o("el-input",{attrs:{disabled:!0},model:{value:t.form.courseName,callback:function(e){t.$set(t.form,"courseName",e)},expression:"form.courseName"}})],1),o("el-form-item",{attrs:{label:"章节名称"}},[o("el-input",{attrs:{disabled:!0},model:{value:t.form.sectionName,callback:function(e){t.$set(t.form,"sectionName",e)},expression:"form.sectionName"}})],1),o("el-form-item",{attrs:{label:"课时名称"}},[o("el-input",{model:{value:t.form.theme,callback:function(e){t.$set(t.form,"theme",e)},expression:"form.theme"}})],1),o("el-form-item",{attrs:{label:"时长"}},[o("el-input",{model:{value:t.form.duration,callback:function(e){t.$set(t.form,"duration",e)},expression:"form.duration"}})],1),o("el-form-item",{attrs:{label:"是否开放试听"}},[o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.form.isFree,callback:function(e){t.$set(t.form,"isFree",e)},expression:"form.isFree"}})],1),o("el-form-item",{attrs:{label:"课时排序"}},[o("el-input",{model:{value:t.form.orderNum,callback:function(e){t.$set(t.form,"orderNum",e)},expression:"form.orderNum"}})],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)},v=[],C={name:"LessonDialogCreateOrEdit",data:function(){return{dialogFormVisible:!1,isCreate:!1,title:"",form:{id:void 0,courseId:0,courseName:"",sectionId:0,sectionName:"",theme:"",duration:0,isFree:!1,orderNum:0,status:0},formLabelWidth:"120px"}},created:function(){this.initData=Object.assign({},this.form)},methods:{showAndInit:function(t,e,o){this.form=Object.assign({},this.initData),this.dialogFormVisible=!0,o.theme?(this.isCreate=!1,this.title="更新课时",this.form.sectionName=e.parent.data.sectionName,this.form.sectionId=e.parent.data.id,Object.assign(this.form,o)):o.sectionName&&(this.isCreate=!0,this.title="添加课时",this.form.sectionName=o.sectionName,this.form.sectionId=o.id),this.form.courseName=t.courseName,this.form.courseId=t.id},onSubmit:function(){var t=this;l(this.form).then((function(e){var o=t.isCreate?"添加课时":"更新课时";"000000"===e.data.code?(t.$message.success("".concat(o,"成功!")),t.$emit("change")):t.$message.error("{$info}失败...")})).finally((function(){t.dialogFormVisible=!1}))}}},_=C,D=(0,p.Z)(_,b,v,!1,null,"40d80446",null),I=D.exports,N=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.title,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[o("el-result",{attrs:{icon:"info",title:t.msg}}),o("el-form",{attrs:{model:t.form}},[o("el-form-item",{attrs:{label:"状态更改为"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.statusData,(function(t,e){return o("el-option",{key:e,attrs:{label:t,value:e}})})),1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)},F=[],S={name:"ChangeStatus",data:function(){return{dialogFormVisible:!1,statusData:[],submitFn:null,title:"",msg:"",nodeData:null,form:{id:0,status:0},formLabelWidth:"120px"}},methods:{onSubmit:function(){var t=this;this.submitFn(this.form).then((function(e){"000000"===e.data.code?(t.$message.success("状态更新成功!"),t.nodeData.status=t.form.status):t.$message.error("状态更新失败...")})).finally((function(){t.dialogFormVisible=!1}))},showAndInit:function(t,e){this.dialogFormVisible=!0,this.nodeData=e,this.form.id=e.id,this.form.status=e.status,e.theme?(this.statusData=["隐藏","未发布","已发布"],this.submitFn=l,this.title="更改课时状态"):(this.statusData=["隐藏","待更新","已发布"],this.submitFn=r,this.title="更改章节状态"),this.msg="当前状态为: ".concat(this.statusData[e.status])}}},U=S,k=(0,p.Z)(U,N,F,!1,null,"24b6fd40",null),$=k.exports,y=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:"上传视频",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[o("el-upload",{staticClass:"upload-demo",attrs:{action:"#",accept:"video/*","before-upload":t.storeVideoFile,"show-file-list":!1}},[o("el-button",{attrs:{type:"primary",plain:""}},[t._v("选择视频")]),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.videoTip))])],1),o("el-upload",{staticClass:"upload-demo",attrs:{action:"#",accept:"image/*","before-upload":t.storeImageFile,"http-request":t.handleUploadImage,"show-file-list":!1}},[o("el-button",{attrs:{type:"primary",plain:""}},[t._v("选择图片")]),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.imageTip))])],1),o("el-button",{attrs:{type:"primary"},on:{click:t.handleUploadVideo}},[t._v("开始上传")]),o("h4",[t._v("上传进度: "+t._s(t.loadedPercent)+"%")]),o("h4",[t._v("转码进度: "+t._s(t.transCodePercent)+"%")])],1)},A=[],V=(o(68309),function(t,e){return(0,n.Z)({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:{fileName:t,imageUrl:e}})}),P=function(){return(0,n.Z)({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"})},x=function(t){return(0,n.Z)({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:t})},T=function(t){return(0,n.Z)({method:"GET",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:t}})},w={name:"UploadVideoImageDialog",data:function(){return{isShow:!1,videoFile:null,imageFile:null,videoTip:"只能上传 mp4 文件",imageTip:"只支持 png jpg gif 格式",imageUrl:"",videoId:"",loadedPercent:0,transCodePercent:0,lessonId:0}},methods:{initUploader:function(){return new window.AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(t){},onUploadSucceed:function(t){},onUploadFailed:function(t,e,o){},onUploadProgress:function(t,e,o){},onUploadTokenExpired:function(t){},onUploadEnd:function(t){}})},showAndInit:function(t,e){this.isShow=!0,this.lessonId=e.id},storeVideoFile:function(t){return this.videoFile=t,this.videoTip=t.name,!1},storeImageFile:function(t){return this.imageFile=t,this.imageTip=t.name,!0},handleUploadImage:function(t){var e=this,o=this.initUploader();o.options.onUploadstarted=function(t){P().then((function(s){if("000000"===s.data.code){var a=s.data.data,n=a.uploadAuth,i=a.uploadAddress,r=a.imageId,l=a.imageURL;o.setUploadAuthAndAddress(t,n,i,r),e.imageUrl=l}else e.$message.error("获取图片上传凭证失败...")}))},o.addFile(t.file),o.startUpload()},handleUploadVideo:function(){var t=this,e=this.initUploader();e.addFile(this.videoFile),e.options.onUploadstarted=function(o){V(t.videoFile.name,t.imageUrl).then((function(s){if("000000"===s.data.code){var a=s.data.data,n=a.uploadAuth,i=a.uploadAddress,r=a.videoId;e.setUploadAuthAndAddress(o,n,i,r),t.videoId=r}else t.$message.error("获取视频上传凭证失败...")}))},e.options.onUploadProgress=function(e,o,s){t.loadedPercent=100*s},e.options.onUploadEnd=function(e){x({lessonId:t.lessonId,coverImageUrl:t.imageUrl,fileId:t.videoId,fileName:t.videoFile.name}).then((function(e){if("000000"===e.data.code)var o=setInterval((function(){T(t.lessonId).then((function(e){t.transCodePercent=e.data.data,100===e.data.data&&(clearInterval(o),t.$message.success("视频转码完成!"))}))}),1e3)}))},e.startUpload()}}},O=w,E=(0,p.Z)(O,y,A,!1,null,"d82ca74c",null),Z=E.exports,j={name:"CourseContent",props:{courseId:{type:[String,Number]}},data:function(){return{course:{},courseContent:[],sectionStatusData:["隐藏","待更新","已发布"],lessonStatusData:["隐藏","未发布","已发布"],defaultProps:{children:"lessonDTOS",label:function(t,e){return t.sectionName||t.theme}}}},created:function(){this.loadCourse(),this.loadCourseContent()},methods:{loadCourse:function(){var t=this;(0,u.zf)(this.courseId).then((function(e){"000000"===e.data.code?t.course=e.data.data:t.$message.error("加载课程基本信息失败...")}))},loadCourseContent:function(){var t=this;i(this.courseId).then((function(e){"000000"===e.data.code?t.courseContent=e.data.data:t.$message.error("加载课程的章节和课时信息失败...")}))},goBack:function(){this.$router.go(-1)},handleSectionDlg:function(t){this.$refs.sectionDlg.showAndInit(this.course,t)},handleLessonDlg:function(t,e){this.$refs.lessonDlg.showAndInit(this.course,t,e)},handleDrop:function(t,e,o){return t.parent.id===e.parent.id&&"inner"!==o},onDroped:function(t,e){var o=this,s=t.data.theme?l:r,a=e.parent.childNodes.map((function(t,e){return s({id:t.data.id,orderNum:e})}));Promise.all(a).then((function(){o.$message.success("后台顺序更新完成!")})).catch((function(){o.$message.error("后台顺序更新失败...")}))},handleChangeStatusDlg:function(t,e){this.$refs.changeStatusDlg.showAndInit(t,e)},handUploadDlg:function(t,e){this.$refs.uploadDlg.showAndInit(t,e)}},components:{SectionDialogCreateOrEdit:g,LessonDialogCreateOrEdit:I,ChangeStatus:$,UploadVideoImageDialog:Z}},L=j,G=(0,p.Z)(L,s,a,!1,null,"3b6ff148",null),z=G.exports},83938:function(t,e,o){o.d(e,{Ho:function(){return a},Ix:function(){return i},M4:function(){return n},jt:function(){return r},zf:function(){return l}});var s=o(25972),a=function(t){return(0,s.Z)({method:"POST",url:"/boss/course/getQueryCourses",data:t})},n=function(t,e){return(0,s.Z)({method:"GET",url:"/boss/course/changeState",params:{courseId:t,status:e}})},i=function(t,e){return(0,s.Z)({method:"POST",url:"/boss/course/upload",data:t,onUploadProgress:e})},r=function(t){return(0,s.Z)({method:"POST",url:"/boss/course/saveOrUpdateCourse",data:t})},l=function(t){return(0,s.Z)({method:"GET",url:"/boss/course/getCourseById",params:{courseId:t}})}}}]);