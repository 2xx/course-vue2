"use strict";(self["webpackChunkedu_boss_fed"]=self["webpackChunkedu_boss_fed"]||[]).push([[728],{2694:function(e,t,o){o.r(t),o.d(t,{default:function(){return z}});var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"course-content"},[o("div",{staticClass:"content-header"},[o("el-page-header",{attrs:{content:e.course.courseName},on:{back:e.goBack}}),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSectionDlg()}}},[e._v("十 添加章节")])],1),o("el-card",{staticClass:"box-card"},[o("el-tree",{attrs:{data:e.courseContent,props:e.defaultProps,draggable:"","allow-drop":e.handleDrop},on:{"node-drop":e.onDroped},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,a=t.data;return o("span",{staticClass:"custom-tree-node"},[o("span",[e._v(e._s(s.label))]),a.sectionName?o("span",[o("el-button",{on:{click:function(t){return t.stopPropagation(),e.handleSectionDlg(a)}}},[e._v("编辑")]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),e.handleLessonDlg(s,a)}}},[e._v(" 添加课时 ")]),o("el-button",{on:{click:function(t){return t.stopPropagation(),e.handleChangeStatusDlg(s,a)}}},[e._v(" "+e._s(e.sectionStatusData[a.status])+" ")])],1):e._e(),a.theme?o("span",[o("el-button",{on:{click:function(t){return t.stopPropagation(),e.handleLessonDlg(s,a)}}},[e._v("编辑")]),o("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handUploadDlg(s,a)}}},[e._v(" 上传视频 ")]),o("el-button",{on:{click:function(t){return t.stopPropagation(),e.handleChangeStatusDlg(s,a)}}},[e._v(" "+e._s(e.lessonStatusData[a.status])+" ")])],1):e._e()])}}])})],1),o("section-dialog-create-or-edit",{ref:"sectionDlg",on:{change:e.loadCourseContent}}),o("lesson-dialog-create-or-edit",{ref:"lessonDlg",on:{change:e.loadCourseContent}}),o("change-status",{ref:"changeStatusDlg"}),o("upload-video-image-dialog",{ref:"uploadDlg"})],1)},a=[],i=o(5972);const r=e=>(0,i.Z)({method:"GET",url:"/boss/course/section/getSectionAndLesson",params:{courseId:e}}),l=e=>(0,i.Z)({method:"POST",url:"/boss/course/section/saveOrUpdateSection",data:e}),n=e=>(0,i.Z)({method:"POST",url:"/boss/course/lesson/saveOrUpdate",data:e});var d=o(3938),u=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:e.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"课程名称"}},[o("el-input",{attrs:{disabled:!0},model:{value:e.form.courseName,callback:function(t){e.$set(e.form,"courseName",t)},expression:"form.courseName"}})],1),o("el-form-item",{attrs:{label:"章节名称"}},[o("el-input",{model:{value:e.form.sectionName,callback:function(t){e.$set(e.form,"sectionName",t)},expression:"form.sectionName"}})],1),o("el-form-item",{attrs:{label:"章节描述"}},[o("el-input",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),o("el-form-item",{attrs:{label:"章节排序"}},[o("el-input",{model:{value:e.form.orderNum,callback:function(t){e.$set(e.form,"orderNum",t)},expression:"form.orderNum"}})],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)},c=[],m={name:"SectionDialogCreateOrEdit",data(){return{dialogFormVisible:!1,isCreate:!1,title:"",initData:{},form:{id:void 0,courseId:0,courseName:"",sectionName:"",description:"",orderNum:0,status:0},formLabelWidth:"120px"}},created(){this.initData=Object.assign({},this.form)},methods:{showAndInit(e,t){this.dialogFormVisible=!0,this.form=Object.assign({},this.initData),t?(this.isCreate=!1,this.title="更新章节",Object.assign(this.form,t)):(this.isCreate=!0,this.title="添加章节"),this.form.courseId=e.id,this.form.courseName=e.courseName},onSubmit(){l(this.form).then((e=>{const t=this.isCreate?"添加章节":"更新章节";"000000"===e.data.code?(this.$message.success(`${t}成功!`),this.$emit("change")):this.$message.error(`${t}失败...`)})).finally((()=>{this.dialogFormVisible=!1}))}}},h=m,p=o(1001),f=(0,p.Z)(h,u,c,!1,null,"59899a4c",null),g=f.exports,b=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:e.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"课程名称"}},[o("el-input",{attrs:{disabled:!0},model:{value:e.form.courseName,callback:function(t){e.$set(e.form,"courseName",t)},expression:"form.courseName"}})],1),o("el-form-item",{attrs:{label:"章节名称"}},[o("el-input",{attrs:{disabled:!0},model:{value:e.form.sectionName,callback:function(t){e.$set(e.form,"sectionName",t)},expression:"form.sectionName"}})],1),o("el-form-item",{attrs:{label:"课时名称"}},[o("el-input",{model:{value:e.form.theme,callback:function(t){e.$set(e.form,"theme",t)},expression:"form.theme"}})],1),o("el-form-item",{attrs:{label:"时长"}},[o("el-input",{model:{value:e.form.duration,callback:function(t){e.$set(e.form,"duration",t)},expression:"form.duration"}})],1),o("el-form-item",{attrs:{label:"是否开放试听"}},[o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.form.isFree,callback:function(t){e.$set(e.form,"isFree",t)},expression:"form.isFree"}})],1),o("el-form-item",{attrs:{label:"课时排序"}},[o("el-input",{model:{value:e.form.orderNum,callback:function(t){e.$set(e.form,"orderNum",t)},expression:"form.orderNum"}})],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)},v=[],C={name:"LessonDialogCreateOrEdit",data(){return{dialogFormVisible:!1,isCreate:!1,title:"",form:{id:void 0,courseId:0,courseName:"",sectionId:0,sectionName:"",theme:"",duration:0,isFree:!1,orderNum:0,status:0},formLabelWidth:"120px"}},created(){this.initData=Object.assign({},this.form)},methods:{showAndInit(e,t,o){this.form=Object.assign({},this.initData),this.dialogFormVisible=!0,o.theme?(this.isCreate=!1,this.title="更新课时",this.form.sectionName=t.parent.data.sectionName,this.form.sectionId=t.parent.data.id,Object.assign(this.form,o)):o.sectionName&&(this.isCreate=!0,this.title="添加课时",this.form.sectionName=o.sectionName,this.form.sectionId=o.id),this.form.courseName=e.courseName,this.form.courseId=e.id},onSubmit(){n(this.form).then((e=>{const t=this.isCreate?"添加课时":"更新课时";"000000"===e.data.code?(this.$message.success(`${t}成功!`),this.$emit("change")):this.$message.error("{$info}失败...")})).finally((()=>{this.dialogFormVisible=!1}))}}},_=C,D=(0,p.Z)(_,b,v,!1,null,"40d80446",null),I=D.exports,N=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-result",{attrs:{icon:"info",title:e.msg}}),o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"状态更改为"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.statusData,(function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)},$=[],F={name:"ChangeStatus",data(){return{dialogFormVisible:!1,statusData:[],submitFn:null,title:"",msg:"",nodeData:null,form:{id:0,status:0},formLabelWidth:"120px"}},methods:{onSubmit(){this.submitFn(this.form).then((e=>{"000000"===e.data.code?(this.$message.success("状态更新成功!"),this.nodeData.status=this.form.status):this.$message.error("状态更新失败...")})).finally((()=>{this.dialogFormVisible=!1}))},showAndInit(e,t){this.dialogFormVisible=!0,this.nodeData=t,this.form.id=t.id,this.form.status=t.status,t.theme?(this.statusData=["隐藏","未发布","已发布"],this.submitFn=n,this.title="更改课时状态"):(this.statusData=["隐藏","待更新","已发布"],this.submitFn=l,this.title="更改章节状态"),this.msg=`当前状态为: ${this.statusData[t.status]}`}}},S=F,U=(0,p.Z)(S,N,$,!1,null,"24b6fd40",null),k=U.exports,y=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:"上传视频",visible:e.isShow},on:{"update:visible":function(t){e.isShow=t}}},[o("el-upload",{staticClass:"upload-demo",attrs:{action:"#",accept:"video/*","before-upload":e.storeVideoFile,"show-file-list":!1}},[o("el-button",{attrs:{type:"primary",plain:""}},[e._v("选择视频")]),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.videoTip))])],1),o("el-upload",{staticClass:"upload-demo",attrs:{action:"#",accept:"image/*","before-upload":e.storeImageFile,"http-request":e.handleUploadImage,"show-file-list":!1}},[o("el-button",{attrs:{type:"primary",plain:""}},[e._v("选择图片")]),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.imageTip))])],1),o("el-button",{attrs:{type:"primary"},on:{click:e.handleUploadVideo}},[e._v("开始上传")]),o("h4",[e._v("上传进度: "+e._s(e.loadedPercent)+"%")]),o("h4",[e._v("转码进度: "+e._s(e.transCodePercent)+"%")])],1)},A=[];const V=(e,t)=>(0,i.Z)({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:{fileName:e,imageUrl:t}}),P=()=>(0,i.Z)({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"}),x=e=>(0,i.Z)({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:e}),T=e=>(0,i.Z)({method:"GET",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:e}});var w={name:"UploadVideoImageDialog",data(){return{isShow:!1,videoFile:null,imageFile:null,videoTip:"只能上传 mp4 文件",imageTip:"只支持 png jpg gif 格式",imageUrl:"",videoId:"",loadedPercent:0,transCodePercent:0,lessonId:0}},methods:{initUploader(){return new window.AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(e){},onUploadSucceed:function(e){},onUploadFailed:function(e,t,o){},onUploadProgress:function(e,t,o){},onUploadTokenExpired:function(e){},onUploadEnd:function(e){}})},showAndInit(e,t){this.isShow=!0,this.lessonId=t.id},storeVideoFile(e){return this.videoFile=e,this.videoTip=e.name,!1},storeImageFile(e){return this.imageFile=e,this.imageTip=e.name,!0},handleUploadImage(e){const t=this.initUploader();t.options.onUploadstarted=e=>{P().then((o=>{if("000000"===o.data.code){const{uploadAuth:s,uploadAddress:a,imageId:i,imageURL:r}=o.data.data;t.setUploadAuthAndAddress(e,s,a,i),this.imageUrl=r}else this.$message.error("获取图片上传凭证失败...")}))},t.addFile(e.file),t.startUpload()},handleUploadVideo(){const e=this.initUploader();e.addFile(this.videoFile),e.options.onUploadstarted=t=>{V(this.videoFile.name,this.imageUrl).then((o=>{if("000000"===o.data.code){const{uploadAuth:s,uploadAddress:a,videoId:i}=o.data.data;e.setUploadAuthAndAddress(t,s,a,i),this.videoId=i}else this.$message.error("获取视频上传凭证失败...")}))},e.options.onUploadProgress=(e,t,o)=>{this.loadedPercent=100*o},e.options.onUploadEnd=e=>{x({lessonId:this.lessonId,coverImageUrl:this.imageUrl,fileId:this.videoId,fileName:this.videoFile.name}).then((e=>{if("000000"===e.data.code){const e=setInterval((()=>{T(this.lessonId).then((t=>{this.transCodePercent=t.data.data,100===t.data.data&&(clearInterval(e),this.$message.success("视频转码完成!"))}))}),1e3)}}))},e.startUpload()}}},O=w,E=(0,p.Z)(O,y,A,!1,null,"d82ca74c",null),Z=E.exports,j={name:"CourseContent",props:{courseId:{type:[String,Number]}},data(){return{course:{},courseContent:[],sectionStatusData:["隐藏","待更新","已发布"],lessonStatusData:["隐藏","未发布","已发布"],defaultProps:{children:"lessonDTOS",label:(e,t)=>e.sectionName||e.theme}}},created(){this.loadCourse(),this.loadCourseContent()},methods:{loadCourse(){(0,d.zf)(this.courseId).then((e=>{"000000"===e.data.code?this.course=e.data.data:this.$message.error("加载课程基本信息失败...")}))},loadCourseContent(){r(this.courseId).then((e=>{"000000"===e.data.code?this.courseContent=e.data.data:this.$message.error("加载课程的章节和课时信息失败...")}))},goBack(){this.$router.go(-1)},handleSectionDlg(e){this.$refs.sectionDlg.showAndInit(this.course,e)},handleLessonDlg(e,t){this.$refs.lessonDlg.showAndInit(this.course,e,t)},handleDrop(e,t,o){return e.parent.id===t.parent.id&&"inner"!==o},onDroped(e,t){const o=e.data.theme?n:l,s=t.parent.childNodes.map(((e,t)=>o({id:e.data.id,orderNum:t})));Promise.all(s).then((()=>{this.$message.success("后台顺序更新完成!")})).catch((()=>{this.$message.error("后台顺序更新失败...")}))},handleChangeStatusDlg(e,t){this.$refs.changeStatusDlg.showAndInit(e,t)},handUploadDlg(e,t){this.$refs.uploadDlg.showAndInit(e,t)}},components:{SectionDialogCreateOrEdit:g,LessonDialogCreateOrEdit:I,ChangeStatus:k,UploadVideoImageDialog:Z}},L=j,G=(0,p.Z)(L,s,a,!1,null,"3b6ff148",null),z=G.exports},3938:function(e,t,o){o.d(t,{Ho:function(){return a},Ix:function(){return r},M4:function(){return i},jt:function(){return l},zf:function(){return n}});var s=o(5972);const a=e=>(0,s.Z)({method:"POST",url:"/boss/course/getQueryCourses",data:e}),i=(e,t)=>(0,s.Z)({method:"GET",url:"/boss/course/changeState",params:{courseId:e,status:t}}),r=(e,t)=>(0,s.Z)({method:"POST",url:"/boss/course/upload",data:e,onUploadProgress:t}),l=e=>(0,s.Z)({method:"POST",url:"/boss/course/saveOrUpdateCourse",data:e}),n=e=>(0,s.Z)({method:"GET",url:"/boss/course/getCourseById",params:{courseId:e}})}}]);